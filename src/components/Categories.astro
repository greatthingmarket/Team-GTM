---
// src/components/Categories.astro
import { Image } from 'astro:assets';
import { categories } from '../data/categories.js';

const { t, currentLang = 'en' } = Astro.props;

// Type guard pour la sécurité des langues
type Locale = 'en' | 'fr' | 'es' | 'de' | 'ar' | 'pt';
const lang = (currentLang as Locale) || 'en';
---

<section id="categories" class="bg-white py-16 lg:py-24">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    
    <div class="text-center mb-12">
      <h2 class="text-3xl md:text-4xl font-extrabold text-dark font-poppins mb-4">
        {t.categories?.title || "Explore by Category"}
      </h2>
      <div class="w-20 h-1.5 bg-primary mx-auto rounded-full"></div>
      <p class="mt-4 text-gray-500 font-inter max-w-2xl mx-auto">
        {t.categories?.subtitle || "Find exactly what you're looking for"}
      </p>
    </div>

    <div class="grid grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8">
      {categories.map((category) => {
        const translation = category.translations[lang] || category.translations.en;
        
        return (
          <a 
            href={`/${lang}/category/${category.slug}`}
            class="group relative bg-white border border-gray-100 rounded-[2.5rem] p-8 text-center shadow-sm hover:shadow-2xl hover:border-primary/20 transition-all duration-500 hover:-translate-y-2 flex flex-col items-center overflow-hidden"
          >
            <div class="absolute inset-0 bg-gradient-to-b from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>

            <div class="relative z-10 w-20 h-20 rounded-3xl bg-gray-50 flex items-center justify-center mb-6 group-hover:bg-primary transition-colors duration-500 shadow-inner">
              {/* Utilisation de <Image /> pour corriger l'affichage des icônes importées */}
              <Image 
                src={category.icon} 
                alt={translation.title}
                width={80} 
                height={80}
                class="w-10 h-10 object-contain group-hover:brightness-0 group-hover:invert transition-all duration-500"
                loading="lazy"
              />
            </div>

            <div class="relative z-10">
              <h3 class="text-lg font-bold text-dark group-hover:text-primary transition-colors duration-300 font-poppins mb-2">
                {translation.title}
              </h3>
              <p class="text-xs md:text-sm text-gray-500 line-clamp-2 leading-relaxed font-inter">
                {translation.description}
              </p>
            </div>

            <div class="mt-4 opacity-0 group-hover:opacity-100 transition-all duration-500 translate-y-4 group-hover:translate-y-0">
               <span class="text-primary text-xs font-bold flex items-center gap-1 uppercase tracking-widest">
                Voir plus
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7" />
                </svg>
               </span>
            </div>
          </a>
        );
      })}
    </div>
  </div>
</section>

<style>
  /* Optimisation du rendu sur mobile pour éviter les coupures de texte */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>