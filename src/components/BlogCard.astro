---
// src/components/BlogCard.astro
import type { CollectionEntry } from 'astro:content';
import { useTranslations } from '../i18n/ui';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

// ✅ CORRECTION : Extraction propre du slug sans extension
const [postLang, ...slugParts] = post.id.split('/');
const postSlug = slugParts.join('/').replace(/\.mdx?$/, ''); // Retire .md ou .mdx

// Récupération sécurisée des traductions
const t = useTranslations(postLang);

const formattedDate = new Date(post.data.date).toLocaleDateString(postLang, {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// ✅ PROTECTION : On vérifie si t.blog existe avant d'accéder à readMore
const readMoreText = t?.blog?.readMore || (postLang === 'fr' ? 'Lire la suite' : 'Read More');
---

<article class="bg-white rounded-2xl shadow-sm hover:shadow-xl transition-all duration-500 overflow-hidden border border-slate-100 flex flex-col h-full group">
  <a href={`/${postLang}/blog/${postSlug}`} class="flex flex-col h-full">
    
    <div class="relative aspect-[16/10] overflow-hidden bg-slate-100">
      <img 
        src={post.data.image} 
        alt={post.data.title} 
        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
      />
      <div class="absolute top-4 left-4">
        <span class="bg-[#1a936f] text-white text-[10px] font-bold uppercase tracking-widest px-3 py-1 rounded-full shadow-lg">
          {post.data.category}
        </span>
      </div>
    </div>

    <div class="p-6 flex flex-col flex-grow">
      <div class="flex items-center text-slate-400 text-xs mb-3 font-medium">
        {formattedDate}
      </div>

      <h3 class="text-slate-900 font-bold text-xl mb-3 leading-tight group-hover:text-[#1a936f] transition-colors line-clamp-2">
        {post.data.title}
      </h3>

      <p class="text-slate-600 text-sm line-clamp-3 mb-6">
        {post.data.description}
      </p>

      <div class="mt-auto pt-4 border-t border-slate-50 flex items-center justify-between text-[#1a936f] font-bold text-xs uppercase tracking-widest">
        <span>{readMoreText}</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-2 transform group-hover:translate-x-2 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </div>
    </div>
  </a>
</article>